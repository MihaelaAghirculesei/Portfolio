<section id="projects">
  <div class="contentWrapper">
    <h2>{{ "portfolio.subtitle" | translate }}</h2>
    <h3>{{ "portfolio.title" | translate }}</h3>
    <p>
      {{ "portfolio.description" | translate }}
    </p>

    <div class="projectWrapper">
      <table class="projects-table" #projectsTable>
        <tbody>
          @for (project of projects; track project.name) {
          <tr
            class="project-row"
            [id]="'project-' + $index"
            (mouseenter)="setActiveProject($index, $event)"
            (mouseleave)="clearActiveProject()"
            (click)="openProjectOverlay(project, $index)"
            (keydown.enter)="openProjectOverlay(project, $index)"
            (keydown.space)="openProjectOverlay(project, $index); $event.preventDefault()"
            appPassiveTouchStart
            (passiveTouchStart)="handleTouchStart($event, $index)"
            appPassiveTouchEnd
            (passiveTouchEnd)="handleTouchEnd($event, $index)"
            role="button"
            tabindex="0"
            [attr.aria-label]="'View details for ' + project.name + ' project'"
          >
            <td class="project-name">
              {{ project.name }}
            </td>
            <td class="project-tech">
              @for (tech of project.technologies; track tech; let last = $last)
              {
              {{ tech }}@if (!last) {<span class="tech-separator"> | </span>} }
            </td>
          </tr>
          }
        </tbody>
      </table>

      @if (activePreview && !selectedProject && hoverPosition !== null) {
      <div
        class="projects-hover-content"
        [style.top.px]="hoverPosition"
        [attr.data-project-id]="activeProjectId"
        aria-hidden="true"
      >
        <div class="imageContainer">
          <img
            [src]="activePreview"
            [alt]="getProjectScreenshotAlt(activeProjectId)"
            loading="lazy"
          />
          <div class="lineDiv" aria-hidden="true"></div>
        </div>
      </div>
      }
    </div>
  </div>

  @if (selectedProject) {
  <div
    class="project-modal-overlay"
    role="dialog"
    aria-modal="true"
    [attr.aria-labelledby]="'project-title-' + selectedIndex"
    [attr.aria-describedby]="'project-description-' + selectedIndex"
  >
    <div
      class="project-modal-backdrop"
      role="presentation"
      tabindex="-1"
      (click)="closeOverlay()"
      (keydown.escape)="closeOverlay()"
      aria-hidden="true"
    ></div>

    <div class="project-modal" tabindex="-1">
      <div class="project-modal-content">
        <div class="project-info">
          <strong class="project-number">{{
            (selectedIndex + 1).toString().padStart(2, "0")
          }}</strong>
          <h2 class="project-title" [id]="'project-title-' + selectedIndex">
            {{ selectedProject.name }}
          </h2>
          <p
            class="project-description"
            [id]="'project-description-' + selectedIndex"
          >
            {{ getProjectShortDescription(selectedProject) }}
          </p>

          <div class="project-long-description">
            <p>{{ getProjectDescription(selectedProject) }}</p>
          </div>

          <div class="project-technologies">
            <div class="tech-tags">
              @for (tech of selectedProject.technologies; track tech) {
              <span class="tech-tag">
                @if (hasTechIcon(tech)) {
                <img
                  [src]="getTechIconPath(tech)"
                  class="tech-icon"
                  [alt]="tech + ' icon'"
                  loading="lazy"
                />
                }
                {{ tech }}
              </span>
              }
            </div>
          </div>

          <div class="project-buttons">
            <a
              [href]="selectedProject.githubUrl"
              target="_blank"
              rel="noopener noreferrer"
              class="link-button2"
              [attr.aria-label]="
                'View ' + selectedProject.name + ' source code on GitHub'
              "
            >
              {{ "portfolio.github" | translate }}
            </a>
            <a
              [href]="selectedProject.liveUrl"
              target="_blank"
              rel="noopener noreferrer"
              class="link-button2"
              [attr.aria-label]="'View ' + selectedProject.name + ' live demo'"
            >
              {{ "portfolio.liveTest" | translate }}
            </a>
          </div>
        </div>

        <div class="project-image-container">
          <button
            class="close-button"
            (click)="closeOverlay()"
            [attr.aria-label]="'portfolio.closeModal' | translate"
            title="Close (ESC)"
          >
            <span class="close-icon" aria-hidden="true"></span>
          </button>

          <div class="project-image">
            <div class="imageContainer">
              <img
                [src]="selectedProject.previewImg"
                [alt]="getProjectScreenshotAlt(selectedIndex)"
                loading="lazy"
              />
            </div>
          </div>
        </div>
      </div>

      <div class="project-modal-footer">
        <button
          class="next-project-button"
          (click)="nextProject()"
          [attr.aria-label]="'portfolio.nextProject' | translate"
          title="Next Project"
        >
          {{ "portfolio.nextProject" | translate }}
        </button>
      </div>
    </div>
  </div>
  }
</section>
